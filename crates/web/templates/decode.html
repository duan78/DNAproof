{% extends "base.html" %}

{% block content %}
<h2 class="text-2xl font-bold text-gray-800 mb-6">ðŸ“¥ DÃ©coder depuis ADN</h2>

<p class="text-gray-600 mb-6">Upload a FASTA file containing DNA sequences to decode.</p>

<div class="upload-zone rounded-xl p-12 text-center cursor-pointer mb-6">
    <input type="file" id="fastaInput" accept=".fasta,.fa" class="hidden" />
    <div class="text-6xl mb-4">ðŸ§¬</div>
    <h3 class="text-xl font-bold text-gray-700 mb-2">Upload FASTA File</h3>
    <p class="text-gray-500">Drag & drop or click to select</p>
</div>

<button id="decodeBtn" disabled class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg disabled:opacity-50">
    ðŸ“¥ DÃ©coder
</button>

<div id="decodeResults" class="hidden mt-6">
    <h3 class="text-xl font-bold text-gray-800 mb-4">âœ… DÃ©codage terminÃ©!</h3>
    <button id="downloadBtn" class="btn-primary w-full py-3 rounded-lg text-white font-medium">
        ðŸ’¾ TÃ©lÃ©charger fichier
    </button>
</div>
{% endblock %}

{% block scripts %}
<script>
const dropZone = document.querySelector('.upload-zone');
const fastaInput = document.getElementById('fastaInput');
const decodeBtn = document.getElementById('decodeBtn');

let selectedFile = null;

dropZone.addEventListener('click', () => fastaInput.click());

fastaInput.addEventListener('change', (e) => {
    if (e.target.files.length) {
        selectedFile = e.target.files[0];
        decodeBtn.disabled = false;
    }
});

decodeBtn.addEventListener('click', async () => {
    if (!selectedFile) return;
    
    const formData = new FormData();
    formData.append('file', selectedFile);
    
    decodeBtn.disabled = true;
    
    try {
        const response = await fetch('/api/decode', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('decodeResults').classList.remove('hidden');
            notificationSystem.success('DÃ©codage terminÃ©', 'Votre fichier a Ã©tÃ© dÃ©codÃ© avec succÃ¨s');
        } else {
            notificationSystem.error('Erreur de dÃ©codage', result.error || 'Erreur inconnue');
        }
    } catch (error) {
        notificationSystem.error('Erreur de connexion', error.message);
    } finally {
        decodeBtn.disabled = false;
    }
});
</script>
{% endblock %}
